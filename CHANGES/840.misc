Use modern pytest paradigms, update dependencies, and updates for flake8.
